<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Firebase OTP Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap (optional for styling) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex justify-content-center align-items-center" style="height:100vh;">

  <div class="card p-4 shadow" style="width:400px;">
    <h4 class="text-center mb-3">Phone OTP Verification</h4>

    <!-- Step 1: Phone input -->
    <div id="phoneSection">
      <input type="tel" id="phoneNumber" class="form-control mb-3" placeholder="Enter phone number">
      <div id="recaptcha-container" class="mb-3"></div>
      <button id="sendBtn" class="btn btn-primary w-100">Send OTP</button>
    </div>

    <!-- Step 2: OTP input -->
    <div id="otpSection" style="display:none;">
      <input type="text" id="otpCode" class="form-control mb-3" placeholder="Enter OTP">
      <button id="verifyBtn" class="btn btn-success w-100">Verify OTP</button>
    </div>
  </div>

  <!-- Firebase + App code -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCZH8gZWByrD_ocvtCDI4MDrIpTo_HJnXs",
      authDomain: "fir-authentication-89be9.firebaseapp.com",
      projectId: "fir-authentication-89be9",
      storageBucket: "fir-authentication-89be9.firebasestorage.app",
      messagingSenderId: "129238925127",
      appId: "1:129238925127:web:c64787f139c96d65ab1662"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Setup reCAPTCHA
    window.recaptchaVerifier = new RecaptchaVerifier(
      'recaptcha-container',
      { size: 'normal' },
      auth
    );
    recaptchaVerifier.render();

    // Send OTP
    document.getElementById('sendBtn').addEventListener('click', async () => {
      let phone = document.getElementById('phoneNumber').value.trim();

      // If 10 digits, prepend +91 (India). Adjust for your country.
      if (/^[0-9]{10}$/.test(phone)) phone = '+91' + phone;

      if (!/^\+\d{6,15}$/.test(phone)) {
        alert('Enter a valid phone number in E.164 format (e.g. +919876543210)');
        return;
      }

      try {
        const confirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
        window.confirmationResult = confirmationResult;
        alert('OTP sent!');
        document.getElementById('phoneSection').style.display = 'none';
        document.getElementById('otpSection').style.display = 'block';
      } catch (err) {
        console.error('Error sending OTP:', err);
        alert(err.message);
      }
    });

    // Verify OTP
    document.getElementById('verifyBtn').addEventListener('click', async () => {
      const code = document.getElementById('otpCode').value.trim();
      if (!window.confirmationResult) {
        alert('Please request OTP first.');
        return;
      }

      try {
        const result = await window.confirmationResult.confirm(code);
        alert('Phone verified successfully!');
        console.log('User:', result.user);
      } catch (err) {
        console.error('Error verifying OTP:', err);
        alert('Invalid OTP: ' + err.message);
      }
    });
  </script>
</body>
</html>

